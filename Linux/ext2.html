
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" xml:lang="zh">
<head>
<title>ext2文件系统</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="ext2文件系统"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-05-01 二"/>
<meta name="author" content="纪秀峰"/>
<meta name="description" content="ext2文件系统"/>
<meta name="keywords" content=""/>
<style type='text/css'>
       body {
    background-color: #E5E5E5;
	scrollbar-face-color: #DEE3E7;
	scrollbar-highlight-color: #FFFFFF;
	scrollbar-shadow-color: #DEE3E7;
	scrollbar-3dlight-color: #D1D7DC;
	scrollbar-arrow-color:  #006699;
	scrollbar-track-color: #EFEFEF;
	scrollbar-darkshadow-color: #98AAB1;
    /* background-color: #999966;  */
    margin: 0em;
}

h1 {
    font-size: 2.0em;
    margin-top: 1.0em;
    margin-bottom: 0.3em;
}
h2 {
    font-size: 1.5em;
    margin-top: 2.4em;
    margin-bottom: 0.3em;
}
h3 {
    font-size: 1.25em;
    margin-top: 1.25em;
    margin-bottom: 0.3em;
}


div#content {
    font-family: Times, serif;
    border-left: double #333300 3mm;
    border-right: double #333300 3mm;
    letter-spacing: 0.075em;
    line-height: 1.4;
    margin: 0em auto;
    padding: 2em;
    width: 92%;
    height:100%; 
    min-height:600px;           /*firefox do'nt support height:100% ,so*/
 
}
/* #table-of-contents { */
/* 	font-size: 75%; */
/* 	line-height: 1.4em; */
/* 	position: fixed; */
/* 	display: block; */
/* 	left: -20px; */
/* 	top: 5%; */
/* 	width: 250px; */
/* 	min-height:60px; */
/* 	max-height:95%; */
/* 	overflow:hidden; */
/*     white-space:nowrap; */
/* } */

#org-div-home-and-up{
	position: fixed;
	display: block;
	right: 18px;
	top: 5px;
	overflow:auto;
    }
#org-src{
	position: fixed;
	display: block;
	right: 18px;
	top: 20px;
	overflow:hidden;
    }
#htmlized-src{
	position: fixed;
	display: block;
	right: 54px;
	top: 20px;
	overflow:hidden;
    }
#table-of-contents h2 {
	display:none;
}

#logo-text{
	position: fixed;
	display: block;
	right: 16px;
	bottom: 3px;
	overflow:hidden;
}
#logo-img{
    font-size: 60%;
	position: fixed;
	display: block;
    left: 16px;
	top: 3px;
    }
div#tags {
	font-size: 75%;
    text-align:right;
	/* line-height: 1.4em; */
	position: fixed;
	display: block;
	right: 40px;
	top: 20%;
	width: 90px;
	/* min-height:60px; */
	max-height:95%;
	/* overflow:visible; */
    /* white-space:pre-wrap; */
}

.title {
    text-align:center;
	padding-bottom: 7px;
	margin-bottom: 20px;
	border-bottom: 1px solid #222;
}
 a:link,a:active,a:visited { color : #006699; } 
 a:hover		{ text-decoration: underline; color : #DD6900; } 

.todo {color: #990000;}
.done {color: #006666;}
.timestamp-kwd {color: #444;}
.tag {color: #DDD; font-size: 70%; font-weight: 500;}

table {border: none;
       width:90%;
      }
th	{
	background-color: #006699; 
}
td	{
    padding: .1em .7em .1em .3em;
	background-color: Gainsboro
}


code {
font-family: Andale Mono, Courier New, Courier, sans-serif; font-size: 12px; line-height: 14px; color: #0000A0;
	background-color: #FAFAFA; border: #D1D7DC; border-style: solid;
	border-left-width: 1px; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px
}

/* pre { */
/* 	border: 1px solid #555; */
/* 	background: #EEEEEE; */
/* 	font-size: 9pt; */
/* 	padding: 1em; */
/* } */
pre.src {
	border: 1px solid #555;
	background:#0c1021;
    /* background:#263111; */
    color: #f7f8c6;
	font-size: 10pt;
    width:85%;
	padding: 0em;
	margin: 0;
	width: 700px;
	float: none;
	clear: none;
	line-height: 1.333;
	text-align:left;
    
    /* overflow: scroll; */
    max-height:500px;           /*IEXPLORE  don't support max-height*/
    _height:expression(this.scrollHeight > 300 ? "300px" : "auto");
    min-height:50px;
    max-width:700px;
    min-width:700px;
    overflow-x:auto;
    overflow-y:auto;
}
blockquote {
	 border: #D1D7DC;
     border-style: solid;
	border-left-width: 1px;
    border-top-width: 1px;
    border-right-width: 1px;
    border-bottom-width: 1px
    
    color: #444444;
    line-height: 125%;
	border: 1px solid #555;
    background-color: #FAFAFA;    
    width:95%;
	padding: 1em;
	margin: 0;
	float: none;
	clear: none;
	text-align:left;
    font-style:italic;
    
    /* overflow: scroll; */
    max-height:300px;           /*IEXPLORE  don't support max-height*/
    _height:expression(this.scrollHeight > 300 ? "300px" : "auto");
    min-height:20px;
    max-width:700px;
    min-width:700px;
    overflow-x:auto;
    overflow-y:auto;
}

.org-function-name {
    /* font-lock-function-name-face */
    /* color: #0000ff; */
     color: #87cefa;
     font-stretch: normal;
     text-decoration: none;
}

.org-keyword {
    /* font-lock-keyword-face */
    color: #00ffff;
    text-decoration: none;
    /* color: #a020f0; */
}
.org-doc
 { color: #ffa07a;
   text-decoration: none;
 }
p.author{
    font-size:80%;
    color:#556b2f;
    font-style:italic;
    position:fixed;
    left:10px;
    bottom:40px;
}
p.date{
    font-size:80%;
    color:#556b2f;
    font-style:italic;
    position:fixed;
    left:10px;
    bottom:0px;
}
p.creator{
    font-size:80%;
    color:#556b2f;
    font-style:italic;
    position:fixed;
    left:10px;
    bottom:20px;
}

img {
    display:inline;
	border: none;
    float:none;
    clear:none;
    left:10px;
}

.share img {
	opacity: .4;
	-moz-opacity: .4;
	filter: alpha(opacity=40);
}

.share img:hover {
	opacity: 1;
	-moz-opacity: 1;
	filter: alpha(opacity=100);
}

.org-info-search-highlight
{
	background-color:#adefef; /* same color as emacs default */
	color:#000000;
	font-weight:bold;
}

.org-bbdb-company {
    /* bbdb-company */
    font-style: italic;
}
.org-bbdb-field-name {
}
.org-bbdb-field-value {
}
.org-bbdb-name {
    /* bbdb-name */
    text-decoration: underline;
}
.org-bold {
    /* bold */
    font-weight: bold;
}
.org-bold-italic {
    /* bold-italic */
    font-weight: bold;
    font-style: italic;
}
.org-border {
    /* border */
    background-color: #000000;
}
.org-buffer-menu-buffer {
    /* buffer-menu-buffer */
    font-weight: bold;
}
.org-builtin {
    /* font-lock-builtin-face */
    color: #da70d6;
}
.org-button {
    /* button */
    text-decoration: underline;
}
.org-c-nonbreakable-space {
    /* c-nonbreakable-space-face */
    background-color: #ff0000;
    font-weight: bold;
}
.org-calendar-today {
    /* calendar-today */
    text-decoration: underline;
}
.org-comment {
    /* font-lock-comment-face */
    color: #b22222;
}
.org-comment-delimiter {
    /* font-lock-comment-delimiter-face */
    color: #b22222;
}
.org-constant {
    /* font-lock-constant-face */
    color: #5f9ea0;
}
.org-cursor {
    /* cursor */
    background-color: #000000;
}
.org-default {
    /* default */
    color: #000000;
    background-color: #ffffff;
}
.org-diary {
    /* diary */
    color: #ff0000;
}
.org-escape-glyph {
    /* escape-glyph */
    color: #a52a2a;
}
.org-file-name-shadow {
    /* file-name-shadow */
    color: #7f7f7f;
}
.org-fixed-pitch {
}
.org-fringe {
    /* fringe */
    background-color: #f2f2f2;
}
.org-header-line {
    /* header-line */
    color: #333333;
    background-color: #e5e5e5;
}
.org-help-argument-name {
    /* help-argument-name */
    font-style: italic;
}
.org-highlight {
    /* highlight */
    background-color: #b4eeb4;
}
.org-holiday {
    /* holiday */
    background-color: #ffc0cb;
}
.org-info-header-node {
    /* info-header-node */
    color: #a52a2a;
    font-weight: bold;
    font-style: italic;
}
.org-info-header-xref {
    /* info-header-xref */
    color: #0000ff;
    text-decoration: underline;
}
.org-info-menu-header {
    /* info-menu-header */
    font-weight: bold;
}
.org-info-menu-star {
    /* info-menu-star */
    color: #ff0000;
}
.org-info-node {
    /* info-node */
    color: #a52a2a;
    font-weight: bold;
    font-style: italic;
}
.org-info-title-1 {
    /* info-title-1 */
    font-size: 172%;
    font-weight: bold;
}
.org-info-title-2 {
    /* info-title-2 */
    font-size: 144%;
    font-weight: bold;
}
.org-info-title-3 {
    /* info-title-3 */
    font-size: 120%;
    font-weight: bold;
}
.org-info-title-4 {
    /* info-title-4 */
    font-weight: bold;
}
.org-info-xref {
    /* info-xref */
    color: #0000ff;
    text-decoration: underline;
}
.org-isearch {
    /* isearch */
    color: #b0e2ff;
    background-color: #cd00cd;
}
.org-italic {
    /* italic */
    font-style: italic;
}
.org-lazy-highlight {
    /* lazy-highlight */
    background-color: #afeeee;
}
.org-link {
    /* link */
    color: #0000ff;
    text-decoration: underline;
}
.org-link-visited {
    /* link-visited */
    color: #8b008b;
    text-decoration: underline;
}
.org-match {
    /* match */
    background-color: #ffff00;
}
.org-menu {
}
.org-message-cited-text {
    /* message-cited-text */
    color: #ff0000;
}
.org-message-header-cc {
    /* message-header-cc */
    color: #191970;
}
.org-message-header-name {
    /* message-header-name */
    color: #6495ed;
}
.org-message-header-newsgroups {
    /* message-header-newsgroups */
    color: #00008b;
    font-weight: bold;
    font-style: italic;
}
.org-message-header-other {
    /* message-header-other */
    color: #4682b4;
}
.org-message-header-subject {
    /* message-header-subject */
    color: #000080;
    font-weight: bold;
}
.org-message-header-to {
    /* message-header-to */
    color: #191970;
    font-weight: bold;
}
.org-message-header-xheader {
    /* message-header-xheader */
    color: #0000ff;
}
.org-message-mml {
    /* message-mml */
    color: #228b22;
}
.org-message-separator {
    /* message-separator */
    color: #a52a2a;
}
.org-minibuffer-prompt {
    /* minibuffer-prompt */
    color: #0000cd;
}
.org-mm-uu-extract {
    /* mm-uu-extract */
    color: #006400;
    background-color: #ffffe0;
}
.org-mode-line {
    /* mode-line */
    color: #000000;
    background-color: #bfbfbf;
}
.org-mode-line-buffer-id {
    /* mode-line-buffer-id */
    font-weight: bold;
}
.org-mode-line-highlight {
}
.org-mode-line-inactive {
    /* mode-line-inactive */
    color: #333333;
    background-color: #e5e5e5;
}
.org-mouse {
    /* mouse */
    background-color: #000000;
}
.org-negation-char {
}
.org-next-error {
    /* next-error */
    background-color: #eedc82;
}
.org-nobreak-space {
    /* nobreak-space */
    color: #a52a2a;
    text-decoration: underline;
}
.org-org-agenda-date {
    /* org-agenda-date */
    color: #0000ff;
}
.org-org-agenda-date-weekend {
    /* org-agenda-date-weekend */
    color: #0000ff;
    font-weight: bold;
}
.org-org-agenda-restriction-lock {
    /* org-agenda-restriction-lock */
    background-color: #ffff00;
}
.org-org-agenda-structure {
    /* org-agenda-structure */
    color: #0000ff;
}
.org-org-archived {
    /* org-archived */
    color: #7f7f7f;
}
.org-org-code {
    /* org-code */
    color: #7f7f7f;
}
.org-org-column {
    /* org-column */
    background-color: #e5e5e5;
}
.org-org-column-title {
    /* org-column-title */
    background-color: #e5e5e5;
    font-weight: bold;
    text-decoration: underline;
}
.org-org-date {
    /* org-date */
    color: #a020f0;
    text-decoration: underline;
}
.org-org-done {
    /* org-done */
    color: #228b22;
    font-weight: bold;
}
.org-org-drawer {
    /* org-drawer */
    color: #0000ff;
}
.org-org-ellipsis {
    /* org-ellipsis */
    color: #b8860b;
    text-decoration: underline;
}
.org-org-formula {
    /* org-formula */
    color: #b22222;
}
.org-org-headline-done {
    /* org-headline-done */
    color: #bc8f8f;
}
.org-org-hide {
    /* org-hide */
    color: #e5e5e5;
}
.org-org-latex-and-export-specials {
    /* org-latex-and-export-specials */
    color: #8b4513;
}
.org-org-level-1 {
    /* org-level-1 */
    color: #0000ff;
}
.org-org-level-2 {
    /* org-level-2 */
    color: #b8860b;
}
.org-org-level-3 {
    /* org-level-3 */
    color: #a020f0;
}
.org-org-level-4 {
    /* org-level-4 */
    color: #b22222;
}
.org-org-level-5 {
    /* org-level-5 */
    color: #228b22;
}
.org-org-level-6 {
    /* org-level-6 */
    color: #5f9ea0;
}
.org-org-level-7 {
    /* org-level-7 */
    color: #da70d6;
}
.org-org-level-8 {
    /* org-level-8 */
    color: #bc8f8f;
}
.org-org-link {
    /* org-link */
    color: #a020f0;
    text-decoration: underline;
}
.org-org-property-value {
}
.org-org-scheduled-previously {
    /* org-scheduled-previously */
    color: #b22222;
}
.org-org-scheduled-today {
    /* org-scheduled-today */
    color: #006400;
}
.org-org-sexp-date {
    /* org-sexp-date */
    color: #a020f0;
}
.org-org-special-keyword {
    /* org-special-keyword */
    color: #bc8f8f;
}
.org-org-table {
    /* org-table */
    color: #0000ff;
}
.org-org-tag {
    /* org-tag */
    font-weight: bold;
}
.org-org-target {
    /* org-target */
    text-decoration: underline;
}
.org-org-time-grid {
    /* org-time-grid */
    color: #b8860b;
}
.org-org-todo {
    /* org-todo */
    color: #ff0000;
}
.org-org-upcoming-deadline {
    /* org-upcoming-deadline */
    color: #b22222;
}
.org-org-verbatim {
    /* org-verbatim */
    color: #7f7f7f;
    text-decoration: underline;
}
.org-org-warning {
    /* org-warning */
    color: #ff0000;
    font-weight: bold;
}
.org-outline-1 {
    /* outline-1 */
    color: #0000ff;
}
.org-outline-2 {
    /* outline-2 */
    color: #b8860b;
}
.org-outline-3 {
    /* outline-3 */
    color: #a020f0;
}
.org-outline-4 {
    /* outline-4 */
    color: #b22222;
}
.org-outline-5 {
    /* outline-5 */
    color: #228b22;
}
.org-outline-6 {
    /* outline-6 */
    color: #5f9ea0;
}
.org-outline-7 {
    /* outline-7 */
    color: #da70d6;
}
.org-outline-8 {
    /* outline-8 */
    color: #bc8f8f;
}
.org-preprocessor {
    /* font-lock-preprocessor-face */
    color: #da70d6;
}
.org-query-replace {
    /* query-replace */
    color: #b0e2ff;
    background-color: #cd00cd;
}
.org-regexp-grouping-backslash {
    /* font-lock-regexp-grouping-backslash */
    font-weight: bold;
}
.org-regexp-grouping-construct {
    /* font-lock-regexp-grouping-construct */
    font-weight: bold;
}
.org-region {
    /* region */
    background-color: #eedc82;
}
.org-rmail-highlight {
}
.org-scroll-bar {
    /* scroll-bar */
    background-color: #bfbfbf;
}
.org-secondary-selection {
    /* secondary-selection */
    background-color: #ffff00;
}
.org-shadow {
    /* shadow */
    color: #7f7f7f;
}
.org-show-paren-match {
    /* show-paren-match */
    background-color: #40e0d0;
}
.org-show-paren-mismatch {
    /* show-paren-mismatch */
    color: #ffffff;
    background-color: #a020f0;
}
.org-string {
    /* font-lock-string-face */
    color: #bc8f8f;
}
.org-texinfo-heading {
    /* texinfo-heading */
    color: #0000ff;
}
.org-tool-bar {
    /* tool-bar */
    color: #000000;
    background-color: #bfbfbf;
}
.org-tooltip {
    /* tooltip */
    color: #000000;
    background-color: #ffffe0;
}
.org-trailing-whitespace {
    /* trailing-whitespace */
    background-color: #ff0000;
}
.org-type {
    /* font-lock-type-face */
    color: #228b22;
}
.org-underline {
    /* underline */
    text-decoration: underline;
}
.org-variable-name {
    /* font-lock-variable-name-face */
    color: #b8860b;
}
.org-variable-pitch {
}
.org-vertical-border {
}
.org-warning {
    /* font-lock-warning-face */
    color: #ff0000;
    font-weight: bold;
}



.logo-link {
    position: fixed;
    top: 10px;
    left: 30px;
}

/* These style are only for IE: */

* html {
    overflow: hidden;
    padding-bottom:0px;
    margin:0px;
}

* html body {
    height: 100%;
    overflow:auto;
    font-size: 100%;
    margin: 0px 0px 0px 250px;
    padding: 0px 10% 0px 0px;
}
/* 针对Ie ,好像因为iexplore 不认识position:fixed 所以没办法让
   导航部分的显示固定在特定的位置，不随滚动条而滚动
 */
* html #table-of-contents {
    position: absolute;
    width:200px;
    left:10px
    /*
      The evil IE-JavaScript hack :-) depends on Picture and y-distance.
      Added to support small screens (Netbooks...).
      */
    top: expression( ( 30 + ( noValue = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop ) ) + 'px' );
    /* top: expression((document.body.clientHeight - 210) + "px"); */
     /* height: expression((document.body.clientHeight - 210) + "px"); */
}
* html #org-div-home-and-up {
    position: absolute;
    width:200px;
    right:25px;
    /*
      The evil IE-JavaScript hack :-) depends on Picture and y-distance.
      Added to support small screens (Netbooks...).
      */
    /* top: expression( ( 10 + ( noValue = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop ) ) + 'px' ); */
    /* top: expression((document.body.clientHeight - 210) + "px"); */
     /* height: expression((document.body.clientHeight - 210) + "px"); */
}
* html #org-src{
    position: absolute;
    width:25px;
    right:20px;
}
* html #htmlized-src{
    position: absolute;
    width:120px;
    right:20px;
}

* html p.author{
    position: absolute;
    width:125px;
    left:20px;
}
* html p.date{
    position: absolute;
    width:225px;
    left:20px;
    bottom:0px;
}
* html p.creator{
    position: absolute;
    width:425px;
    left:20px;
    bottom:20px;
}

* html h1 {
    margin-top:10px;
}

* html .logo-link {
    position: absolute;
    top: 10px;
    left: 30px;
}

* html #logo-text{
    font-size: 75%;
	position: absolute;
	display: block;
	right: 10px;
	bottom: 3px;
	overflow:hidden;
}
 
 
* html div#tags {
	font-size: 75%;
	/* line-height: 1.4em; */
	position: absolute;
	display: block;
	right: -2px;
	top: 10%;
	width: 150px;
	/* min-height:60px; */
	max-height:95%;
	/* overflow:visible; */
    /* white-space:pre-wrap; */
}

    </style>
<link rel="stylesheet" type="text/css" href="../style/emacs.css" />
<script type='text/javascript' src='../js/emacs.js'> </script>

</head>
<body>
<div id="org-div-home-and-up" style="text-align:right;font-size:70%;white-space:nowrap;">
 <a accesskey="h" href="../sitemap.html"> 站点地图 </a>
 |
 <a accesskey="H" href="../index.html"> 首页 </a>
</div>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">ext2文件系统</h1>


<div id='logo-img' ><a  href='../index.html'>▇█▓▒░◕~◕░▒▓█▇</a></div>

<div id='logo-text'>
  <a href='#' ><span align="left">░◕~◕░</span></a>
</div>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">链接</a></li>
<li><a href="#sec-2">ext2</a>
<ul>
<li><a href="#sec-2-1">超级块（Super Block）</a></li>
<li><a href="#sec-2-2">块组描述符表（GDT，Group Descriptor Table）</a></li>
<li><a href="#sec-2-3">块位图（Block Bitmap）</a></li>
<li><a href="#sec-2-4">inode位图（inode Bitmap）</a></li>
<li><a href="#sec-2-5">inode表（inode Table）</a></li>
<li><a href="#sec-2-6">数据块（Data Block）</a></li>
</ul>
</li>
<li><a href="#sec-3">可用的命令</a></li>
<li><a href="#sec-4">系统函数</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">链接</h2>
<div class="outline-text-2" id="text-1">

<p>  <a href="http://learn.akae.cn/media/ch29s02.html">http://learn.akae.cn/media/ch29s02.html</a><br/>
</p></div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">ext2</h2>
<div class="outline-text-2" id="text-2">

<p>  <img src="../download/ext2.png"  alt="../download/ext2.png" /><br/>
</p>
<p><br/>
  文件系统中存储的最小单位是块（Block），一个块究竟多大是在格式化时确定的，例如<br/>
  mke2fs的-b选项可以设定块大小为1024、2048或4096字节,默认是1024byte。<br/>
  一个分区的开头必须有1k的boot block，这1k是PC标准规定的，任何文件系统不能使用这<br/>
  块内容,启动块之后才是文件系统。<br/>
  ext2文件系统将整个分区划成若干个同样大小的块组（Block Group）<br/>
</p>
</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1">超级块（Super Block）</h3>
<div class="outline-text-3" id="text-2-1">

<p>   描述 <i>整个分区</i> 的文件系统信息，例如块大小、文件系统版本号、上次mount的时间等<br/>
   等。超级块在每个块组的开头都有一份拷贝。(占用一个block块大小).<br/>
   由于super block很重要 ，在每个 block group都会存一份进行备份.<br/>
</p>
<p><br/>
</p></div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2">块组描述符表（GDT，Group Descriptor Table）</h3>
<div class="outline-text-3" id="text-2-2">

<p>   由很多块组描述符组成，整个分区分成多少个块组就对应有多少个块组描述符。每个<br/>
   块组描述符（Group Descriptor）存储一个块组的描述信息，例如在这个块组中从哪<br/>
   里开始是inode表，从哪里开始是数据块，空闲的inode和数据块还有多少个等等。和<br/>
   超级块类似，块组描述符表在每个块组的开头也都有一份拷贝<sub>，这些信息是非常重要</sub><br/>
   的，一旦超级块意外损坏就会丢失整个分区的数据，一旦块组描述符意外损坏就会丢<br/>
   失整个块组的数据，因此它们都有多份拷贝。/通常内核只用到第0个块组中的拷贝/，当<br/>
   执行e2fsck检查文件系统一致性时，第0个块组中的超级块和块组描述符表就会拷贝到<br/>
   其它块组，这样当第0个块组的开头意外损坏时就可以用其它拷贝来恢复，从而减少损<br/>
   失。<br/>
</p></div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3">块位图（Block Bitmap）</h3>
<div class="outline-text-3" id="text-2-3">

<p>   一个块组中的块是这样利用的：数据块存储所有文件的数据，比如某个分区的块大小<br/>
   是1024字节，某个文件是2049字节，那么就需要三个数据块来存，即使第三个块只存<br/>
   了一个字节也需要占用一个整块；超级块、块组描述符表、块位图、inode位图、<br/>
   inode表这几部分存储该块组的描述信息。那么如何知道哪些块已经用来存储文件数据<br/>
   或其它描述信息，哪些块仍然空闲可用呢？块位图就是用来描述整个块组中哪些块已<br/>
   用哪些块空闲的，它本身占一个块，其中的每个bit代表本块组中的一个块，这个bit<br/>
   为1表示该块已用，这个bit为0表示该块空闲可用。<br/>
   为什么用df命令统计整个磁盘的已用空间非常快呢？因为只需要查看每个块组的块位<br/>
   图即可，而不需要搜遍整个分区。相反，用du命令查看一个较大目录的已用空间就非<br/>
   常慢，因为不可避免地要搜遍整个目录的所有文件。<br/>
   与此相联系的另一个问题是：在格式化一个分区时究竟会划出多少个块组呢？主要的<br/>
   限制在于块位图本身必须只占一个块。用mke2fs格式化时默认块大小是1024字节，可<br/>
   以用-b参数指定块大小，现在设块大小指定为b字节，那么一个块可以有8b个bit，这<br/>
   样大小的一个块位图就可以表示8b个块的占用情况，因此一个块组最多可以有8b个块，<br/>
   如果整个分区有s个块，那么就可以有s/(8b)个块组。格式化时可以用-g参数指定一个<br/>
   块组有多少个块，但是通常不需要手动指定，mke2fs工具会计算出最优的数值。<br/>
</p>
<p><br/>
</p></div>

</div>

<div id="outline-container-2-4" class="outline-3">
<h3 id="sec-2-4">inode位图（inode Bitmap）</h3>
<div class="outline-text-3" id="text-2-4">

<p>   和块位图类似，本身占一个块，其中每个bit表示一个inode是否空闲可用。<br/>
</p></div>

</div>

<div id="outline-container-2-5" class="outline-3">
<h3 id="sec-2-5">inode表（inode Table）</h3>
<div class="outline-text-3" id="text-2-5">

<p>   我们知道，一个文件除了数据需要存储之外，一些描述信息也需要存储，例如文件类<br/>
   型（常规、目录、符号链接等），权限，文件大小，创建/修改/访问时间等，也就是<br/>
   ls -l命令看到的那些信息，这些信息存在inode中而不是数据块中。每个文件都有一<br/>
   个inode，一个块组中的所有inode组成了inode表。<br/>
   <img src="../download/fs.rootinode.png"  alt="../download/fs.rootinode.png" /><br/>
</p>
<p><br/>
   inode表占多少个块在格式化时就要决定并写入块组描述符中，mke2fs格式化工具的默认策<br/>
   略是一个块组有多少个8KB就分配多少个inode。由于数据块占了整个块组的绝大部分，也<br/>
   可以近似认为数据块有多少个8KB就分配多少个inode，换句话说，如果平均每个文件的大<br/>
   小是8KB，当分区存满的时候inode表会得到比较充分的利用，数据块也不浪费。如果这个<br/>
   分区存的都是很大的文件（比如电影），则数据块用完的时候inode会有一些浪费，如果这<br/>
   个分区存的都是很小的文件（比如源代码），则有可能数据块还没用完inode就已经用完了，<br/>
   数据块可能有很大的浪费。如果用户在格式化时能够对这个分区以后要存储的文件大小做<br/>
   一个预测，也可以用mke2fs的-i参数手动指定每多少个字节分配一个inode。<br/>
</p>
<p><br/>
</p></div>

</div>

<div id="outline-container-2-6" class="outline-3">
<h3 id="sec-2-6">数据块（Data Block）</h3>
<div class="outline-text-3" id="text-2-6">


<p><br/>
   根据不同的文件类型有以下几种情况<br/>
</p><ul>
<li>对于常规文件，文件的数据存储在数据块中。<br/>
</li>
<li>对于目录，该目录下的所有文件名和目录名存储在数据块中，注意文件名保存<br/>
          在它所在目录的数据块中，除文件名之外，ls -l命令看到的其它信息都保存在<br/>
          该文件的inode中。注意这个概念：目录也是一种文件，是一种特殊类型的文件。<br/>
</li>
<li>对于符号链接，如果目标路径名较短则直接保存在inode中以便更快地查找，如<br/>
          果目标路径名较长则分配一个数据块来保存。<br/>
</li>
<li>设备文件、FIFO和socket等特殊文件没有数据块，设备文件的主设备号和次设<br/>
          备号保存在inode中<br/>
</li>
</ul>

<p>   默认的块大小是4k.<br/>
</p>
<p><br/>
</p>
<p><br/>
<pre class="src src-sh">dd <span class="org-variable-name">if</span>=/dev/zero <span class="org-variable-name">of</span>=fs <span class="org-variable-name">count</span>=256 <span class="org-variable-name">bs</span>=4K
mke2fs fs
</pre>

   块大小是1024字节，1MB的分区共有1024个块，第0个块是启动块，启动块之后才算ext2文<br/>
   件系统的开始，因此Group 0占据第1个到第1023个块，共1023个块。块位图占一个块，共<br/>
   有1024×8=8192个bit，足够表示这1023个块了，因此只要一个块组就够了。默认是每8KB<br/>
   分配一个inode，因此1MB的分区对应128个inode，这些数据都和dumpe2fs的输出吻合。<br/>
</p>
<p><br/>
</p>
<p><br/>
</p>
<p><br/>
   从000000开始的1KB是启动块，由于这不是一个真正的磁盘分区，启动块的内容全部为<br/>
   零。从000400到0007ff的1KB是超级块，对照着dumpe2fs的输出信息，详细分析如下：<br/>
   <img src="../download/fs.sb.png"  alt="../download/fs.sb.png" /><br/>
</p>
<p><br/>
   从000800开始是块组描述符表，这个文件系统较小，只有一个块组描述符，对照着<br/>
   dumpe2fs的输出信息分析如下：<br/>
   <img src="../download/fs.gd.png"  alt="../download/fs.gd.png" /><br/>
</p>
<p><br/>
<pre class="src src-sh">dumpe2fs /dev/vg1/portage
dumpe2fs /tmp/fs
</pre>

</p><blockquote>

<p>Group 0: (Blocks 1-1023)<br/>
Primary superblock at 1, Group descriptors at 2-2<br/>
Reserved GDT blocks at 3-5<br/>
Block bitmap at 6 (+5), Inode bitmap at 7 (+6)<br/>
Inode table at 8-23 (+7)<br/>
986 free blocks, 117 free inodes, 2 directories<br/>
Free blocks: 38-1023<br/>
Free inodes: 12-128<br/>
</p>
</blockquote>


<p><br/>
   jkk块组描述符指出，空闲的inode有117个，由于文件系统是新创建的，空闲的inode也是<br/>
   连续的，inode编号从1到128，空闲的inode编号从12到128。从inode位图可以看出，前<br/>
   11位都是1，表示前11个inode已用<br/>
   001c00这一行的128位就表示了所有inode，因此下面的行不管是0还是1都没有意义。已<br/>
   用的11个inode中，前10个inode是被ext2文件系统保留的，其中第2个inode是根目录，<br/>
   第11个inode是lost+found目录，块组描述符也指出该组有两个目录，就是根目录和<br/>
   lost+found。<br/>
</p>
<p><br/>
   整个文件系统是1MB，每个块是1KB，应该有1024个块，除去启动块还有1023个块，分别编<br/>
   号为1-1023，它们全都属于Group 0。其中，Block 1是超级块，接下来的块组描述符指出，<br/>
   块位图是Block 6，因此中间的Block 2-5是块组描述符表，其中Block 3-5保留未用。块<br/>
   组描述符还指出，inode位图是Block 7，inode表是从Block 8开始的，那么inode表到哪<br/>
   个块结束呢？由于超级块中指出每个块组有128个inode，每个inode的大小是128字节，因<br/>
   此共占16个块，inode表的范围是Block 8-23,<br/>
   <img src="../download/fs.datablock.png"  alt="../download/fs.datablock.png" /><br/>
   所以数据块从第24block开始 24*1024 =0x6000<br/>
</p>
<p><br/>
   数据块里的记录是不定长的，<br/>
   结构是<br/>
</p><blockquote>

<p>inode号（4bytes）|记录长度   (2bytes)|filename length(1byte)|filetype(1byte)|filename(不定长)|<br/>
</p>
</blockquote>


<p><br/>
   上图中分别显示 了 . .. lost+found<br/>
</p><blockquote>

<p>00006000: 0200 0000 0c00 0102 2e00 0000 0200 0000  &hellip;&hellip;&hellip;&hellip;&hellip;.<br/>
00006010: 0c00 0202 2e2e 0000 0b00 0000 1400 0a02  &hellip;&hellip;&hellip;&hellip;&hellip;.<br/>
00006020: 6c6f 7374 2b66 6f75 6e64 0000 0c00 0000  lost+found&hellip;&hellip;<br/>
00006030: 1000 0501 6865 6c6c 6f00 0000 0d00 0000  &hellip;.hello&hellip;&hellip;.<br/>
</p>
</blockquote>


<p><br/>
   以上内容分别是<br/>
</p><blockquote>

<p>0200 0000 对应的inode号是0x00000002 ,<br/>
0c00 此条记录共长 12 (0x000c=12),<br/>
01 filename名长度是1,<br/>
02 filetype 是2,表示目录<br/>
2e00 0000   0x00000023 是 "." ,即/目录下的"."<br/>
这几个字节数数正好是12bytes<br/>
</p>
</blockquote>


<p><br/>
   接下的来描述的是 ".."<br/>
</p><blockquote>

<p>0200 0000<br/>
0c00 0202 2e2e 0000<br/>
</p>
</blockquote>


<p><br/>
   接下来的描述的是"lost+found"<br/>
</p><blockquote>

<p>0b00 0000 1400 0a02<br/>
6c6f 7374 2b66 6f75 6e64 0000<br/>
对应0b00 0000 ,0x0000000b号inode,即第11个inode<br/>
1400 ，0x0014表示，此程记录共占用20byte,<br/>
0a 文件长度是10,<br/>
02 文件类型是目录<br/>
6c6f 7374 2b66 6f75 6e64 是lost+found几个字,<br/>
你可以把“lost+found”写到一个文件中，用十六进制编辑器查看<br/>
,最后那4个0不太理解。<br/>
</p>
</blockquote>


<p><br/>
</p></div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">可用的命令</h2>
<div class="outline-text-2" id="text-3">

<p>  dumpe2fs<br/>
</p>
<p><br/>
</p></div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">系统函数</h2>
<div class="outline-text-2" id="text-4">


<p><br/>
<pre class="src src-c"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;dirent.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;string.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdlib.h&gt;</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">struct dirent { </span><span class="org-comment-delimiter">*/</span>
<span class="org-comment-delimiter">/*  </span><span class="org-comment">ino_t          d_ino;       /\* inode number *\/ </span><span class="org-comment-delimiter">*/</span>
<span class="org-comment-delimiter">/*  </span><span class="org-comment">off_t          d_off;       /\* offset to the next dirent *\/ </span><span class="org-comment-delimiter">*/</span>
<span class="org-comment-delimiter">/*  </span><span class="org-comment">unsigned short d_reclen;    /\* length of this record *\/ </span><span class="org-comment-delimiter">*/</span>
<span class="org-comment-delimiter">/*  </span><span class="org-comment">unsigned char  d_type;      /\* type of file *\/ </span><span class="org-comment-delimiter">*/</span>
<span class="org-comment-delimiter">/*  </span><span class="org-comment">char           d_name[256]; /\* filename *\/ </span><span class="org-comment-delimiter">*/</span>
<span class="org-comment-delimiter">/* </span><span class="org-comment">}; </span><span class="org-comment-delimiter">*/</span>

<span class="org-type">int</span> <span class="org-function-name">main</span>(<span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span> *<span class="org-variable-name">argv</span>[])
{
  <span class="org-keyword">struct</span> <span class="org-type">dirent</span> *<span class="org-variable-name">dp</span>;
  <span class="org-type">DIR</span> *<span class="org-variable-name">dfd</span>;
  <span class="org-keyword">if</span>((dfd= opendir(<span class="org-string">"/tmp/d/"</span>))==<span class="org-constant">NULL</span>){
    fprintf(stderr,<span class="org-string">"opendir error"</span>);
    exit(1);
  }
  <span class="org-keyword">while</span>( (dp = readdir(dfd))!=<span class="org-constant">NULL</span>){
    fprintf(stdout,<span class="org-string">"%s\n"</span>,dp-&gt;d_name);
  }
  closedir(dfd);
  <span class="org-keyword">return</span> 0;
}
</pre>


<div id='my-src'>
<div id='org-src'><a href='../src/Linux/ext2.org'>src</a></div>
<div id='htmlized-src'><a href='../htmlized-src/Linux/ext2.org.html'>htmlized-src</a></div>
</div>
<div id='tags'><span id='tags-title'>Tags:</span><br />
    <a href="../tags/@SVN.html">@SVN</a><br/>
    <a href="../tags/@perl.html">@perl</a><br/>
    <a href="../tags/@Java.html">@Java</a><br/>
    <a href="../tags/@Mysql.html">@Mysql</a><br/>
    <a href="../tags/@Erlang.html">@Erlang</a><br/>
    <a href="../tags/@SQL.html">@SQL</a><br/>
    <a href="../tags/@DB.html">@DB</a><br/>
    <a href="../tags/@Oracle.html">@Oracle</a><br/>
    <a href="../tags/@Ediff.html">@Ediff</a><br/>
    <a href="../tags/@Git.html">@Git</a><br/>
    <a href="../tags/@Cedet.html">@Cedet</a><br/>
    <a href="../tags/@C-C++.html">@C-C++</a><br/>
    <a href="../tags/@Daily.html">@Daily</a><br/>
    <a href="../tags/@Eclipse.html">@Eclipse</a><br/>
    <a href="../tags/@AutoHotKey.html">@AutoHotKey</a><br/>
    <a href="../tags/@Windows.html">@Windows</a><br/>
    <a href="../tags/@Linux.html">@Linux</a><br/>
    <a href="../tags/@C.html">@C</a><br/>
    <a href="../tags/@Emacs.html">@Emacs</a><br/>
</p>
<p><br/>
</div>
</p></div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2012-05-01 二</p>
<p class="author">Author: 纪秀峰</p>
<p class="creator">Org version 7.8.03 with Emacs version 24</p>


</div>
<p><br/><br/>
<!-- hhmts start --> <!-- hhmts end --></p>

</body>
</html>
